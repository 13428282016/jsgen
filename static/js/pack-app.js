//router.js
angular.module("jsGen.router",[]).constant("app",{version:jsGenVersion}).provider("getFile",["app",function(c){this.html=function(b){return"/static/tpl/"+b+"?v="+(c.version||"")};this.md=function(b){return"/static/md/"+b+"?v="+(c.version||"")};this.$get=function(){return{html:this.html,md:this.md}}}]).config(["$routeProvider","$locationProvider","getFileProvider",function(c,b,a){b={templateUrl:a.html("index.html"),controller:"indexCtrl"};var h={templateUrl:a.html("login.html"),controller:"userLoginCtrl"},
k={templateUrl:a.html("register.html"),controller:"userRegisterCtrl"},e={templateUrl:a.html("user.html"),controller:"homeCtrl"},f={templateUrl:a.html("admin.html"),controller:"adminCtrl"},g={templateUrl:a.html("article-editor.html"),controller:"articleEditorCtrl"},l={templateUrl:a.html("index.html"),controller:"tagCtrl"},m={templateUrl:a.html("reset.html"),controller:"userResetCtrl"},d={templateUrl:a.html("user.html"),controller:"userCtrl"},n={templateUrl:a.html("article.html"),controller:"articleCtrl"};
a={templateUrl:a.html("collection.html"),controller:"collectionCtrl"};c.when("/hots",b).when("/update",b).when("/latest",b).when("/T:ID",b).when("/tag/:TAG",b).when("/login",h).when("/register",k).when("/reset",m).when("/home",e).when("/home/:OP",e).when("/admin",f).when("/admin/:OP",f).when("/tag",l).when("/add",g).when("/A:ID/edit",g).when("/user/U:ID",d).when("/user/U:ID/:OP",d).when("/U:ID",d).when("/U:ID/:OP",d).when("/A:ID",n).when("/C:ID",a).when("/",b).otherwise({redirectTo:"/"})}]);

//tools.js
angular.module("jsGen.tools",[]).factory("tools",function(){function m(a){return Array.isArray&&Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)}function r(a){return null===a||void 0===a||a!==a}function s(a){return r(a)?"":a+""}function n(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function t(a){for(var b in a)if(n(a,b))return!1;return!0}function f(a){var b=typeof a;return null===a?"null":m(a)?"array":b}function g(a,b,c,d){b=b||angular.noop;if(a)if(d||m(a)){d=0;for(var e=
a.length;d<e&&b.call(c,a[d],d,a)!==p;d++);}else for(e in a)if(n(a,e)&&b.call(c,a[e],e,a)===p)break}function h(a,b){var c=f(a);void 0===b&&(b=a,a="object"===c?{}:[]);c===f(b)&&("object"===c||"array"===c?g(b,function(b,c){var k=f(b);"object"===k||"array"===k?(a[c]=k===f(a[c])?a[c]:"object"===k?{}:[],h(a[c],b)):a[c]="function"===k?null:b}):a="function"===c?null:b);return a}function q(a,b){var c=f(a);if(c===f(b)&&("array"===c||"object"===c))if(t(a))h(a,b);else if("array"===c&&1===a.length){var d=a[0],
e=f(d);a.length=0;"function"!==e&&g(b,function(b){var c=f(b);if("null"===e||e===c)"object"===e||"array"===e?a.push(q(h(d),b)):a.push(h(b))})}else g(a,function(e,d){var l=f(e);"array"===c||n(b,d)?"function"===l&&"array"===c?a[d]=null:"null"===l?a[d]=h(b[d]):l===f(b[d])?"object"===l||"array"===l?q(a[d],b[d]):a[d]=b[d]:delete a[d]:delete a[d]});return a}var p={};return{trim:function(a,b){a=s(a);a=a.replace(b&&/\s+/g||/ +/g," ");a=a.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")},each:g,some:function(a,
b,c){var d=!1,e=Array.prototype.some;b=b||angular.noop;if(a){if(e&&a.some===e)return a.some(b,c);g(a,function(a,e,f){if(d=b.call(c,a,e,f))return p});return!!d}return d},union:h,toStr:s,isNull:r,hasOwn:n,isEmpty:t,isArray:m,intersect:q,checkType:f,digestArray:function(a){var b=[];return m(a)?(g(a,function(a){"undefined"!==f(a)&&b.push(a)}),b):a}}});

//locale_zh-cn.js
angular.module("jsGen.locale",["ngLocale"]).run(["$locale",function(a){angular.extend(a,{RESET:{locked:"\u7533\u8bf7\u89e3\u9501",passwd:"\u627e\u56de\u5bc6\u7801",email:"\u8bf7\u6c42\u4fe1\u606f\u5df2\u53d1\u9001\u5230\u60a8\u7684\u90ae\u7bb1\uff0c\u8bf7\u67e5\u6536\u3002"},RESPONSE:{success:"\u8bf7\u6c42\u6210\u529f",error:"\u8bf7\u6c42\u5931\u8d25"},VALIDATE:{required:"\u5fc5\u586b\uff01",minlength:"\u592a\u77ed\uff01",maxlength:"\u592a\u957f\uff01",min:"\u592a\u5c0f\uff01",max:"\u592a\u5927\uff01",
more:"\u592a\u591a\uff01",email:"Email\u65e0\u6548\uff01",pattern:"\u683c\u5f0f\u65e0\u6548\uff01",username:"\u6709\u6548\u5b57\u7b26\u4e3a\u6c49\u5b57\u3001\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf\uff0c\u4ee5\u6c49\u5b57\u6216\u5c0f\u5199\u5b57\u6bcd\u5f00\u5934\uff01",minname:"\u957f\u5ea6\u5e94\u5927\u4e8e5\u5b57\u8282\uff0c\u4e00\u4e2a\u6c49\u5b573\u5b57\u8282\uff01",maxname:"\u957f\u5ea6\u5e94\u5c0f\u4e8e15\u5b57\u8282\uff0c\u4e00\u4e2a\u6c49\u5b573\u5b57\u8282\uff01",repasswd:"\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01",
url:"URL\u65e0\u6548\uff01",tag:"\u6807\u7b7e\u9519\u8bef\uff0c\u4e0d\u80fd\u5305\u542b\u201c,\u201d\u3001\u201c\uff0c\u201d\u548c\u201c\u3001\u201d"},BTN_TEXT:{confirm:"\u786e\u5b9a",cancel:"\u53d6\u6d88",remove:"\u5220\u9664",goBack:"\u8fd4\u56de"},TIMING:{goHome:"\u79d2\u949f\u540e\u81ea\u52a8\u8fd4\u56de\u4e3b\u9875"},HOME:{title:"\u6211\u7684\u4e3b\u9875",index:" \u66f4\u65b0\uff0c\u9605\u8bfb\u65f6\u95f4\u7ebf\uff1a",mark:"\u6211\u7684\u6536\u85cf",article:"\u6211\u7684\u6587\u7ae0",comment:"\u6211\u7684\u8bc4\u8bba",
follow:"\u6211\u7684\u5173\u6ce8",fans:"\u6211\u7684\u7c89\u4e1d"},ADMIN:{index:"\u7f51\u7ad9\u4fe1\u606f",user:"\u7528\u6237\u7ba1\u7406",tag:"\u6807\u7b7e\u7ba1\u7406",article:"\u6587\u7ae0\u7ba1\u7406",comment:"\u8bc4\u8bba\u7ba1\u7406",message:"\u6d88\u606f\u7ba1\u7406",global:"\u7f51\u7ad9\u8bbe\u7f6e",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u8bbe\u7f6e\u6682\u65e0\u53d8\u66f4"},ARTICLE:{title:"\u6dfb\u52a0/\u7f16\u8f91\u6587\u7ae0",preview:"\u9884\u89c8\uff1a",reply:"\u8bc4\u8bba\uff1a",
removed:"\u6210\u529f\u5220\u9664 ",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u6587\u7ae0\u6682\u65e0\u53d8\u66f4",added:"\u6210\u529f\u4fdd\u5b58 ",markdown:"Markdown\u7b80\u660e\u8bed\u6cd5",marked:"\u5df2\u6536\u85cf ",unmarked:"\u5df2\u53d6\u6d88\u6536\u85cf ",favored:"\u5df2\u652f\u6301 ",unfavored:"\u5df2\u53d6\u6d88\u652f\u6301 ",opposed:"\u5df2\u53cd\u5bf9 ",unopposed:"\u5df2\u53d6\u6d88\u53cd\u5bf9 ",highlight:"\u7f6e\u9876 ",unhighlight:"\u53d6\u6d88\u7f6e\u9876 "},USER:{title:"\u7684\u4e3b\u9875",
login:"\u7528\u6237\u767b\u5f55",reset:"\u7528\u6237\u4fe1\u606f\u627e\u56de",register:"\u7528\u6237\u6ce8\u518c",article:"\u7684\u6587\u7ae0",fans:"\u7684\u7c89\u4e1d",followed:"\u5df2\u5173\u6ce8 ",unfollowed:"\u5df2\u53d6\u6d88\u5173\u6ce8 ",email:"\u9a8c\u8bc1\u90ae\u4ef6\u5df2\u53d1\u9001\u5230\u65b0\u90ae\u7bb1\uff0c\u901a\u8fc7\u9a8c\u8bc1\u540e\u624d\u4fdd\u5b58\u4fee\u6539",updated:"\u7528\u6237\u4fe1\u606f\u66f4\u65b0\u6210\u529f",noUpdate:"\u7528\u6237\u4fe1\u606f\u6682\u65e0\u53d8\u66f4",
noLogin:"\u60a8\u8fd8\u672a\u767b\u5f55"},TAG:{title:"\u70ed\u95e8\u6807\u7b7e",removed:"\u6210\u529f\u5220\u9664 ",updated:"\u6210\u529f\u66f4\u65b0 ",noUpdate:"\u6807\u7b7e\u6682\u65e0\u53d8\u66f4"},FILTER:{role:"\u7981\u8a00 \u5f85\u9a8c\u8bc1 \u4f1a\u5458 \u7ec4\u5458 \u7f16\u8f91 \u7ba1\u7406\u5458".split(" "),follow:["\u5173\u6ce8","\u5df2\u5173\u6ce8"],favor:["\u652f\u6301","\u5df2\u652f\u6301"],mark:["\u6536\u85cf","\u5df2\u6536\u85cf"],oppose:["\u53cd\u5bf9","\u5df2\u53cd\u5bf9"],highlight:["\u7f6e\u9876",
"\u53d6\u6d88\u7f6e\u9876"],turn:["\u5f00\u542f","\u5173\u95ed"],edit:["\u6dfb\u52a0","\u7f16\u8f91"],gender:{male:"\u7537",female:"\u5973"}},DATETIME:{second:"\u79d2",minute:"\u5206",hour:"\u65f6",day:"\u5929",month:"\u6708",year:"\u5e74",fullD:"yyyy\u5e74MM\u6708dd\u65e5 HH:mm",shortD:"MM-dd HH:mm",dayAgo:"\u5929\u524d",hourAgo:"\u5c0f\u65f6\u524d",minuteAgo:"\u5206\u949f\u524d",secondAgo:"\u521a\u521a"}})}]);

//services.js
angular.module("jsGen.services",["ngResource","ngCookies"]).factory("restAPI",["$resource",function(d){return{index:d("/api/index/:OP"),user:d("/api/user/:ID/:OP"),article:d("/api/article/:ID/:OP"),tag:d("/api/tag/:ID/:OP")}}]).factory("cache",["$cacheFactory",function(d){return{user:d("user",{capacity:20}),article:d("article",{capacity:100}),comment:d("comment",{capacity:500}),list:d("list",{capacity:100})}}]).factory("myConf",["$cookieStore","tools",function(d,a){function b(c,b){return function(f,
e,g){e=a.toStr(e)+c;g=a.isNull(g)?b:g;var h;h=d.get(e);var l=g;h=a.isNull(h)?l:h;a.isNull(f)||h===(a.isNull(f)?g:f)||(d.put(e,f),h=f);return h}}return{pageSize:b("PageSize",10),listModel:b("ListModel",!1)}}]).factory("anchorScroll",function(){function d(a){a=$(a);var b=$(window),c=b.height(),d=a.offset().top;a=a.outerHeight();var b=b.scrollTop(),f=b+c;return d+(a>c?c:a)/2>b&&d+(a>c?c:a)/2<f?!0:a>c?d+a-c/2>b&&d+a-c/2<f:!1}return{toView:function(a,b,c){var k=$(window).height();a=$(a);c=0<c?c:k/10;$("html, body").animate({scrollTop:b?
a.offset().top-c:a.offset().top+a.outerHeight()+c-k},{duration:200,easing:"linear",complete:function(){d(a)||a[0].scrollIntoView(!!b)}})},inView:d}}).factory("applyFn",["$rootScope",function(d){return function(a,b){a=angular.isFunction(a)?a:angular.noop;b=b&&b.$apply?b:d;a();b.$$phase||b.$apply()}}]).factory("timing",["$rootScope","$q","$exceptionHandler",function(d,a,b){function c(c,f,e){var g,h=0,l=a.defer(),m=l.promise;c=angular.isFunction(c)?c:angular.noop;f=parseInt(f,10);e=parseInt(e,10);e=
0<=e?e:0;g=window.setInterval(function(){h+=1;if(e&&h>=e)window.clearInterval(g),l.resolve(c(h,e,f));else try{c(h,e,f)}catch(a){l.reject(a),b(a)}d.$$phase||d.$apply()},f);m.$timingId=g;return m}c.cancel=function(a){return a&&a.$timingId?(clearInterval(a.$timingId),!0):!1};return c}]).factory("promiseGet",["$q",function(d){return function(a,b,c,k){var f,e=d.defer();(f=c&&k&&k.get(c))?e.resolve(f):b.get(a,function(a){c&&k&&k.put(c,a);e.resolve(a)},function(a){e.reject(a.error)});return e.promise}}]).factory("getList",
["restAPI","cache","promiseGet",function(d,a,b){return function(c){return b({ID:c,OP:10},d.article,c,a.list)}}]).factory("getArticle",["restAPI","cache","promiseGet",function(d,a,b){return function(c){return b({ID:c},d.article,c,a.article)}}]).factory("getUser",["restAPI","cache","promiseGet",function(d,a,b){return function(c){return b({ID:c},d.user,c,a.user)}}]).factory("getMarkdown",["$http",function(d){return d.get("/static/md/markdown.md",{cache:!0})}]).factory("toast",["$log","tools",function(d,
a){var b={};angular.forEach(["info","error","success","warning"],function(c){b[c]=function(b,f){var e=d[c]||d.log;f=a.toStr(f);e(b,f);b=angular.isObject(b)?angular.toJson(b):a.toStr(b);toastr[c](b,f)}});toastr.options=angular.extend({positionClass:"toast-bottom-full-width"},b.options);b.clear=toastr.clear;return b}]).factory("pretty",function(){return prettyPrint}).factory("param",function(){return $.param}).factory("CryptoJS",function(){return CryptoJS}).factory("utf8",function(){return utf8}).factory("mdParse",
["tools",function(d){return function(a){return marked(d.toStr(a))}}]).factory("sanitize",["tools",function(d){var a=Sanitize,b=a.Config,c=[new a({}),new a(b.RESTRICTED),new a(b.BASIC),new a(b.RELAXED)];return function(a,b){var e=document.createElement("div"),g=document.createElement("div");b=0<=b?b:3;e.innerHTML=d.toStr(a);g.appendChild(c[b].clean_node(e));return g.innerHTML}}]).factory("mdEditor",["mdParse","sanitize","pretty","tools",function(d,a,b,c){return function(k,f){k=c.toStr(k);var e=new Markdown.Editor({makeHtml:function(b){return a(d(b),
f)}},k),g=angular.element(document.getElementById("wmd-preview"+k));e.hooks.chain("onPreviewRefresh",function(){angular.forEach(g.find("code"),function(a){a=angular.element(a);0===a.children().length&&a.addClass("prettyprint")});g.find("pre").addClass("prettyprint");b()});return e}}]);

//filters.js
angular.module("jsGen.filters",[]).filter("placeholder",["tools",function(c){return function(a){return c.toStr(a)||"-"}}]).filter("match",["$locale",function(c){return function(a,b){return c.FILTER[b]&&c.FILTER[b][a]||""}}]).filter("switch",["$locale",function(c){return function(a,b){return c.FILTER[b]&&c.FILTER[b][+!!a]||""}}]).filter("checkName",["tools",function(c){return function(a){a=c.toStr(a);return/^[(\u4e00-\u9fa5)a-z][(\u4e00-\u9fa5)a-zA-Z0-9_]{1,}$/.test(a)}}]).filter("length",["utf8",
"tools",function(c,a){return function(b){b=a.toStr(b);return c.stringToBytes(b).length}}]).filter("cutText",["utf8","tools",function(c,a){return function(b,e){b=a.toStr(b);b=b.replace(/\s+/g," ");var d=c.stringToBytes(b);e=e||0;d.length>e&&(d.length=e,b=c.bytesToString(d),b=b.slice(0,-2)+"\u2026");return b}}]).filter("formatDate",["$filter","$locale",function(c,a){return function(b,e){var d=Date.now()-b,f=c("date");return e?f(b,a.DATETIME.fullD):2592E5<d?f(b,a.DATETIME.shortD):864E5<d?Math.floor(d/
864E5)+a.DATETIME.dayAgo:36E5<d?Math.floor(d/36E5)+a.DATETIME.hourAgo:6E4<d?Math.floor(d/6E4)+a.DATETIME.minuteAgo:a.DATETIME.secondAgo}}]).filter("formatTime",["$locale",function(c){return function(a){function b(a){d=f%a;return f=(f-d)/a}var e="",d=0,f=0<a?Math.round(a):Math.floor(Date.now()/1E3);a=c.DATETIME;b(60);e=d+a.second;b(60);e=(0<d?d+a.minute:"")+e;b(24);e=(0<d?d+a.hour:"")+e;return 0<f?f+a.day+e:e}}]).filter("formatBytes",["$locale",function(c){return function(a){return(a=0<a?a:0)?1024>
a?a+"B":1048576>a?(a/1024).toFixed(3)+" KiB":1073741824>a?(a/1048576).toFixed(3)+" MiB":(a/1073741824).toFixed(3)+" GiB":"-"}}]);

//directives.js
angular.module("jsGen.directives",[]).directive("genParseMd",["mdParse","sanitize","pretty",function(h,c,a){return function(e,b,l){e.$watch(l.genParseMd,function(e){e||0===e?(e=h(e),e=c(e),b.html(e),angular.forEach(b.find("code"),function(b){b=angular.element(b);0===b.children().length&&b.addClass("prettyprint")}),b.find("pre").addClass("prettyprint"),b.find("a").attr("target",function(){if(this.host!==location.host)return"_blank"}),a()):b.html("")})}}]).directive("genTabClick",function(){return{link:function(h,
c,a){var e=a.genTabClick;c.bind("click",function(){c.parent().children().removeClass(e);c.addClass(e)})}}}).directive("genPagination",["getFile",function(h){return{scope:!0,templateUrl:h.html("gen-pagination.html"),link:function(c,a,e){c.$watchCollection(e.genPagination,function(b,e){if(angular.isObject(b)){var a=1,d=[],k=Math.ceil(b.total/b.pageSize)||1,a=1<=b.pageIndex?b.pageIndex:1,a=a<=k?a:k;d[0]=a;if(6>=a)for(;1<d[0];)d.unshift(d[0]-1);else d.unshift(d[0]-1),d.unshift(d[0]-1),d.unshift("\u2026"),
d.unshift(2),d.unshift(1);if(5>=k-a)for(;d[d.length-1]<k;)d.push(d[d.length-1]+1);else d.push(d[d.length-1]+1),d.push(d[d.length-1]+1),d.push("\u2026"),d.push(k-1),d.push(k);c.prev=1<a?a-1:0;c.next=a<k?a+1:0;c.total=b.total;c.pageIndex=a;c.showPages=d;c.pageSize=b.pageSize;c.perPages=b.sizePerPage||[10,20,50];c.path=b.path&&b.path+"?p="}});c.paginationTo=function(b,a){!c.path&&0<b&&(a=a||c.pageSize,c.$emit("genPagination",b,a))}}}}]).directive("genModal",["getFile","$timeout",function(h,c){var a=
0;return{scope:!0,transclude:!0,templateUrl:h.html("gen-modal.html"),link:function(e,b,l){function h(a){return function(){var b=p(a)?a():!0;k(!b)}}function d(){var a=$(window),b=f.children(),e=0.382*(a.height()-b.outerHeight()),c={};c.top=0<e?e:0;0<g.width&&(a=a.width()-20,g.width=Math.min(g.width,a),c.width=g.width,c.marginLeft=-g.width/2,c.width===a&&(c.paddingLeft=c.paddingRight=0));b.css(c)}function k(a){f.modal(a?"show":"hide");a&&c(d)}var m,f=b.children(),q=["Confirm","Cancel","Delete"],g=e.$eval(l.genModal),
p=angular.isFunction;b.is(":visible")&&(g.cancelFn=g.cancelFn||!0,g.backdrop=g.backdrop||"static",g.show=g.show||!1,g.modal=k,e.$watch(function(){return g},function(a){angular.extend(e,a)},!0),e.id=e.id||l.genModal+"-"+a++,angular.forEach(q,function(a){var b=a.toLowerCase(),c=b+"Fn",d=b+"Btn";e[b+"Cb"]=g[c]&&h(g[c]);e[d]=g[d]||g[c]&&a}),f.on("shown.bs.modal",function(a){a.stopPropagation();m=!0}),f.on("hidden.bs.modal",function(a){a.stopPropagation();m&&p(g.cancelFn)&&g.cancelFn();m=!1}),f.modal(g))}}}]).directive("genTooltip",
["$timeout",function(h){return{require:"?ngModel",link:function(c,a,e,b){function l(c){b.validate=m&&f.validate&&a.is(":visible");if(b.validate){var d=b.$name&&b.$name+" "||"";c&&f.validateMsg&&angular.forEach(b.$error,function(a,b){d+=a&&f.validateMsg[b]&&f.validateMsg[b]+", "||""});d=d.slice(0,-2)||e.originalTitle||e.title;e.$set("dataOriginalTitle",d?d:"");k(!!c)}else k(!1)}function n(a){h(function(){l(b.$invalid)});return a}function d(){a.off(".tooltip").removeData("tooltip");a.tooltip(f)}function k(b){a.hasClass("invalid-error")!==
b&&(a[b?"addClass":"removeClass"]("invalid-error"),a.tooltip(b?"show":"hide"))}var m=!1,f=c.$eval(e.genTooltip)||{};"inner"===f.container?f.container=a:"ngView"===f.container&&(f.container=a.parents(".ng-view")[0]||a.parents("[ng-view]")[0]);f.validate?(f.template='<div class="tooltip validate-tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',f.trigger="manual",f.placement=f.placement||"right",b?(b.$formatters.push(n),b.$parsers.push(n)):c.$watch(function(){return e.originalTitle||
e.dataOriginalTitle},k),c.$on("genTooltipValidate",function(a,c,d){m=!d;b&&(angular.isArray(c)&&c.push(b),l(b.$invalid))})):f.click&&a.bind("click",function(){a.tooltip(f.click)});a.bind("hidden.bs.tooltip",d);d()}}}]).directive("genMoving",["anchorScroll",function(h){return{link:function(c,a,e){function b(){var b=a.find("textarea");b.is(b)&&b.css({height:"auto",width:"100%"})}c=c.$eval(e.genMoving);c.appendTo=function(c){a.appendTo($(c));b()};c.prependTo=function(c){a.prependTo($(c));b()};c.childrenOf=
function(b){return $(b).find(a).is(a)};c.scrollIntoView=function(b,c){h.toView(a,b,c)};c.inView=function(){return h.inView(a)}}}}]).directive("genSrc",function(){return{priority:99,link:function(h,c,a){a.$observe("genSrc",function(e){if(e&&c.is(":visible")){var b=new Image;b.onload=function(){a.$set("src",e)};b.src=e}})}}});

//controllers.js
angular.module("jsGen.controllers",["ui.validate"]).controller("indexCtrl",["app","$scope","$routeParams","getList",function(a,b,c,d){function f(){var e={ID:h,p:c.p,s:c.s||g.pageSize(null,"index",10)};a.promiseGet(e,k,a.param(e),a.cache.list).then(function(e){var c=e.pagination||{};e.tag&&(b.other.title=e.tag.tag,b.other._id=e.tag._id);c.path=a.location.path();c.pageSize=g.pageSize(c.pageSize,"index");b.pagination=c;b.articleList=e.data})}var h="",k=a.restAPI.article,g=a.myConf,l=a.rootScope.global;
l.title2=l.description;b.parent={getTpl:a.getFile.html("index-article.html"),viewPath:"latest",listModel:g.listModel(l.isPhone||null,"index",!1)};b.other={};b.pagination={};b.setListModel=function(){var a=b.parent;a.listModel=g.listModel(!a.listModel,"index");g.pageSize(a.listModel?20:10,"index");f()};(function(){var e=a.location.path().slice(1).split("/");c.TAG||/^T[0-9A-Za-z]{3,}$/.test(e[0])?(k=a.restAPI.tag,b.other._id=e[0],b.other.title=c.TAG||e[0],b.parent.viewPath=""):(k=a.restAPI.article,
b.parent.viewPath=e[0]||"latest");h=c.TAG||e[0]})();f();d("comment").then(function(e){e=a.union(e.data);a.each(e,function(b,e){b.content=a.filter("cutText")(a.trim(b.content,!0),180)});b.hotComments=e.slice(0,6)})}]).controller("tagCtrl",["app","$scope","$routeParams","getList",function(a,b,c,d){var f=a.restAPI.tag,h=a.myConf;c={p:c.p,s:c.s||h.pageSize(null,"tag",50)};a.rootScope.global.title2=a.locale.TAG.title;b.parent={getTpl:a.getFile.html("index-tag.html")};b.pagination={};a.promiseGet(c,f,a.param(c),
a.cache.list).then(function(c){var g=c.pagination||{};g.path=a.location.path();g.pageSize=h.pageSize(g.pageSize,"tag");g.sizePerPage=[50,100,200];b.pagination=g;b.tagList=c.data});d("comment").then(function(c){c=a.union(c.data);a.each(c,function(b,c){b.content=a.filter("cutText")(a.trim(b.content,!0),180)});b.hotComments=c.slice(0,6)})}]).controller("userLoginCtrl",["app","$scope",function(a,b){a.clearUser();a.rootScope.global.title2=a.locale.USER.login;b.login={logauto:!0,logname:"",logpwd:""};b.reset=
{title:"",type:""};b.submit=function(){if(a.validate(b)){var c=a.union(b.login);c.logtime=Date.now()-a.timeOffset;c.logpwd=a.CryptoJS.SHA256(c.logpwd).toString();c.logpwd=a.CryptoJS.HmacSHA256(c.logpwd,c.logname+":"+c.logtime).toString();a.restAPI.user.save({ID:"login"},c,function(c){a.rootScope.global.user=c.data;a.checkUser();b.$destroy();a.location.path("/home")},function(c){b.reset.type=c.error.name;b.reset.title=a.locale.RESET[c.error.name]})}}}]).controller("userResetCtrl",["app","$scope","$routeParams",
function(a,b,c){function d(){b.timingModal.modal(!0);f=a.timing(function(a,c){b.parent.timing=c-a},1E3,b.parent.timing);f.then(function(){b.timingModal.modal(!1);a.location.search({}).path("/")})}var f,h=a.locale;a.rootScope.global.title2=h.USER.reset;b.reset={name:"",email:"",request:c.req};b.parent={title:h.RESET[c.req],timing:5};b.timingModal={confirmBtn:h.BTN_TEXT.goBack,confirmFn:function(){a.timing.cancel(f);a.timing(null,100,1).then(function(){a.location.search({}).path("/")});return!0},cancelBtn:h.BTN_TEXT.cancel,
cancelFn:function(){return a.timing.cancel(f)}};b.submit=function(){a.validate(b)&&a.restAPI.user.save({ID:"reset"},b.reset,function(b){a.toast.success(h.RESET.email,h.RESPONSE.success);d()})};0>["locked","passwd"].indexOf(c.req)&&a.restAPI.user.get({ID:"reset",OP:c.req},function(){a.toast.success(3+h.TIMING.goHome,h.RESPONSE.success);a.timing(null,1E3,3).then(function(){a.location.search({}).path("/home")})},d)}]).controller("userRegisterCtrl",["app","$scope",function(a,b){var c=a.filter,d=c("length"),
f=a.rootScope.global;a.clearUser();f.title2=a.locale.USER.register;b.user={name:"",email:"",passwd:"",passwd2:""};b.checkName=function(a,b){return c("checkName")(b.$value)};b.checkMin=function(a,b){return 5<=d(b.$value)};b.checkMax=function(a,b){return 15>=d(b.$value)};b.submit=function(){var c=b.user;if(a.validate(b)){var d={name:c.name,email:c.email};d.passwd=a.CryptoJS.SHA256(c.passwd).toString();a.restAPI.user.save({ID:"register"},d,function(c){a.rootScope.global.user=c.data;a.checkUser();b.$destroy();
a.location.path("/home")})}}}]).controller("homeCtrl",["app","$scope","$routeParams",function(a,b,c){var d=a.rootScope.global;if(!d.isLogin)return a.location.search({}).path("/");d.title2=a.locale.HOME.title;b.user=d.user;b.parent={getTpl:a.getFile.html(function(a){switch(a){case "follow":case "fans":return"user-list.html";case "detail":return"user-edit.html";case "article":case "comment":case "mark":return"user-article.html";default:return"user-article.html"}}(c.OP)),isMe:!0,viewPath:c.OP||"index"}}]).controller("userCtrl",
["app","$scope","$routeParams","getUser",function(a,b,c,d){a.rootScope.global.title2=a.locale.USER.title;b.parent={getTpl:a.getFile.html(function(){switch(c.OP){case "fans":return"user-list.html";case "article":return"user-article.html";default:return"user-article.html"}}()),isMe:!1,viewPath:c.OP||"index"};d("U"+c.ID).then(function(c){b.user=c.data;a.rootScope.global.title2=b.user.name+a.locale.USER.title})}]).controller("userListCtrl",["app","$scope","$routeParams",function(a,b,c){var d=a.restAPI.user,
f=a.myConf,h=a.locale,k={ID:c.ID&&"U"+c.ID||c.OP,OP:c.OP||"fans",p:c.p,s:c.s||f.pageSize(null,"user",20)};b.parent={title:""};a.promiseGet(k,d,a.param(k),a.cache.list).then(function(d){var l=d.pagination||{};l.path=a.location.path();l.pageSize=f.pageSize(l.pageSize,"user");b.pagination=l;a.each(d.data,function(b){a.checkFollow(b)});b.parent.title=c.ID?d.user.name+h.USER[k.OP]:h.HOME[k.OP];b.userList=d.data})}]).controller("userArticleCtrl",["app","$scope","$routeParams",function(a,b,c){function d(){var d=
{ID:c.ID&&"U"+c.ID||c.OP,OP:c.OP||(c.ID?"article":"index"),p:c.p,s:c.s||h.pageSize(null,"home",10)};a.promiseGet(d,f,a.param(d),a.cache.list).then(function(e){var m=0,f=e.pagination||{};f.path=a.location.path();f.pageSize=h.pageSize(f.pageSize,"home");b.pagination=f;if(c.ID)b.parent.title=e.user.name+k.USER[d.OP];else{var n=g.user||{};a.each(e.data,function(a){0<e.readtimestamp&&(a.read=a.updateTime<e.readtimestamp,m+=!a.read);a.isAuthor=a.author._id===n._id});b.parent.title="index"!==d.OP?k.HOME[d.OP]:
m+k.HOME.index+a.filter("date")(e.readtimestamp,"medium")}b.articleList=e.data})}var f=a.restAPI.user,h=a.myConf,k=a.locale,g=a.rootScope.global;b.parent={listModel:h.listModel(g.isPhone||null,"index",!1),title:""};b.pagination={};b.removeArticle=null;b.removeArticleModal={confirmBtn:k.BTN_TEXT.confirm,confirmFn:function(){var c=b.removeArticle;a.restAPI.article.remove({ID:c._id},function(){a.some(b.articleList,function(b,d,f){if(b._id===c._id)return f.splice(d,1),a.toast.success(k.ARTICLE.removed+
c.title,k.RESPONSE.success),!0});b.removeArticle=null});return!0},cancelBtn:k.BTN_TEXT.cancel,cancelFn:function(){b.removeArticle=null;return!0}};b.setListModel=function(){var a=b.parent;a.listModel=h.listModel(!a.listModel,"home");h.pageSize(a.listModel?20:10,"home");d()};b.remove=function(a){a.isAuthor&&(b.removeArticle=a,b.removeArticleModal.modal(!0))};d()}]).controller("userEditCtrl",["app","$scope",function(a,b){function c(){d=a.union(k.user);a.each(d.tagsList,function(a,b,c){c[b]=a.tag});d=
a.intersect(a.union(l),d);b.user=a.union(d);a.checkDirty(l,d,b.user)}var d={},f=a.locale,h=a.filter,k=a.rootScope.global,g=h("length"),l={avatar:"",name:"",sex:"",email:"",desc:"",passwd:"",tagsList:[""]};b.sexArray=["male","female"];b.checkName=function(a,b){return h("checkName")(b.$value)};b.checkMin=function(a,b){return 5<=g(b.$value)};b.checkMax=function(a,b){return 15>=g(b.$value)};b.checkDesc=function(a,b){return g(b.$value)<=k.SummaryMaxLen};b.checkTag=function(a,b){var c=b.$value||"",c=angular.isString(c)?
c.split(/[,\uff0c\u3001]/):c;return c.length<=k.UserTagsMax};b.getTag=function(a){var c=b.user.tagsList;0>c.indexOf(a.tag)&&c.length<k.UserTagsMax&&(b.user.tagsList=c.concat(a.tag))};b.reset=function(){b.user=a.union(d)};b.verifyEmail=function(){a.restAPI.user.save({ID:"reset"},{request:"role"},function(){a.toast.success(f.RESET.email,f.RESPONSE.success)})};b.submit=function(){var e=a.union(b.user);a.validate(b)&&(e=a.checkDirty(l,d,e),a.isEmpty(e)?a.toast.info(f.USER.noUpdate):(e.passwd&&(e.passwd=
a.CryptoJS.SHA256(e.passwd).toString()),e.email&&(a.restAPI.user.save({ID:"reset"},{email:e.email,request:"email"},function(){a.toast.success(f.USER.email,f.RESPONSE.success)}),delete e.email),a.isEmpty(e)?c():a.restAPI.user.save({},e,function(b){a.union(k.user,b.data);c();a.toast.success(f.USER.updated,f.RESPONSE.success)})))};b.$watchCollection("user",function(b){a.checkDirty(l,d,b)});c()}]).controller("articleCtrl",["app","$scope","$routeParams","mdEditor","getList","getMarkdown",function(a,b,
c,d,f,h){function k(b){var c=p._id;angular.isObject(b)&&(b.isAuthor=c===b.author._id,b.isMark=a.some(b.markList,function(a){return a._id===c}),b.isFavor=a.some(b.favorsList,function(a){return a._id===c}),b.isOppose=a.some(b.opposesList,function(a){return a._id===c}),a.each(b.commentsList,function(a){k(a)}))}function g(){n.isLogin||a.toast.error(q.USER.noLogin);return n.isLogin}function l(){var a=b.comment,c=b.article;a.replyToComment="";a.title="\u8bc4\u8bba\uff1a"+s(c.title,n.TitleMaxLen-9);a.content=
"";a.refer=c._id;b.replyMoving.prependTo("#comments")}var e="A"+c.ID,m=a.myConf,q=a.locale,n=a.rootScope.global;c=a.filter;var u=c("length"),s=c("cutText"),r=a.cache.comment,v=a.cache.list,t=a.restAPI.article,p=n.user||{},p={_id:p._id,name:p.name,avatar:p.avatar};b.parent={wmdPreview:!1,contentBytes:0,markdownHelp:""};b.comment={title:"",content:"",refer:"",replyToComment:""};b.replyMoving={};b.commentMoving={};b.markdownModal={title:q.ARTICLE.markdown,cancelBtn:q.BTN_TEXT.goBack,width:720};b.validateTooltip=
a.union(a.rootScope.validateTooltip);b.validateTooltip.placement="bottom";b.wmdHelp=function(){h.success(function(a){b.parent.markdownHelp=a;b.markdownModal.modal(!0)})};b.wmdPreview=function(){b.parent.wmdPreview=!b.parent.wmdPreview;b.replyMoving.scrollIntoView(!0)};b.checkContentMin=function(a,c){var e=u(c.$value);b.parent.contentBytes=e;return e>=n.ContentMinLen};b.checkContentMax=function(a,b){return u(b.$value)<=n.ContentMaxLen};b.reply=function(c){var e=b.comment;e.refer=c._id;b.parent.wmdPreview=
!1;c._id===b.article._id?l():(e.replyToComment=c._id,e.title=q.ARTICLE.reply+s(a.sanitize(a.mdParse(c.content),0),n.TitleMaxLen-9),b.replyMoving.appendTo("#"+c._id));b.replyMoving.scrollIntoView()};b.getComments=function(c,e){function d(){var b=[];a.each(c,function(a){g[a]&&b.push(g[a])});return b}var f=[],g={};b.referComments=[];e&&(c&&0<c.length)&&(b.commentMoving.childrenOf("#"+e._id)?b.commentMoving.appendTo("#comments"):(b.commentMoving.appendTo("#"+e._id),a.each(c,function(a){var b=r.get(a);
b?g[a]=b:f.push(a)}),b.referComments=d(),0<f.length&&t.save({ID:"comment"},{data:f},function(c){a.each(c.data,function(a){k(a);r.put(a._id,a);g[a._id]=a});b.referComments=d()})))};b.highlight=function(a){a.status=2===a.status?1:2};b.setMark=function(b){g()&&t.save({ID:b._id,OP:"mark"},{mark:!b.isMark},function(){b.isMark=!b.isMark;b.isMark?b.markList.push(p):a.removeItem(p,"_id",b.markList);a.toast.success(q.ARTICLE[b.isMark?"marked":"unmarked"])})};b.setFavor=function(b){g()&&t.save({ID:b._id,OP:"favor"},
{favor:!b.isFavor},function(){b.isFavor=!b.isFavor;b.isFavor?(b.favorsList.push(p),a.removeItem(p,"_id",b.opposesList),b.isOppose=!1):a.removeItem(p,"_id",b.favorsList);a.toast.success(q.ARTICLE[b.isFavor?"favored":"unfavored"])})};b.setOppose=function(b){g()&&t.save({ID:b._id,OP:"oppose"},{oppose:!b.isOppose},function(){b.isOppose=!b.isOppose;b.isOppose?(b.opposesList.push(p),a.removeItem(p,"_id",b.favorsList),b.isFavor=!1):a.removeItem(p,"_id",b.opposesList);a.toast.success(q.ARTICLE[b.isOppose?
"opposed":"unopposed"])})};b.submit=function(){if(g()&&a.validate(b)){var c=a.union(b.comment),e=b.article;t.save({ID:e._id,OP:"comment"},c,function(c){var d=c.data,f=b.comment.replyToComment;e.commentsList.unshift(d);e.comments+=1;e.updateTime=Date.now();f&&a.some(e.commentsList,function(a,b){if(f===a._id)return e.commentsList[b].commentsList.push(d._id),!0});r.put(d._id,d);l()})}};b.$on("genPagination",function(c,d,f){c.stopPropagation();c={ID:e,OP:"comment",p:d,s:m.pageSize(f,"comment",10)};a.promiseGet(c,
t,a.param(c),v).then(function(c){var e=c.pagination||{};c=c.data;e.pageSize=m.pageSize(e.pageSize,"comment");b.pagination=e;a.each(c,function(a){k(a);r.put(a._id,a)});b.article.commentsList=c;a.anchorScroll.toView("#comments",!0)})});d().run();a.promiseGet({ID:e},t,e,a.cache.article).then(function(c){var e=c.pagination||{};c=c.data;e.pageSize=m.pageSize(e.pageSize,"comments");k(c);a.each(c.commentsList,function(a){r.put(a._id,a)});n.title2=c.title;b.pagination=e;b.article=c;l();a.promiseGet({ID:c.author._id,
OP:"article"},a.restAPI.user,c.author._id,v).then(function(c){var e=c.user,d=b.article.author;a.checkFollow(e);a.union(d,e);d.articlesList=c.data})});f("hots").then(function(a){b.hotArticles=a.data.slice(0,10)})}]).controller("articleEditorCtrl",["app","$scope","$routeParams","mdEditor","getMarkdown",function(a,b,c,d,f){function h(c){r=a.union(s);c&&(c=a.union(c),a.each(c.tagsList,function(a,b,c){c[b]=a.tag}),c.refer=c.refer&&c.refer.url,a.intersect(r,c));b.article=a.union(r);a.checkDirty(s,r,b.article);
k(c)}function k(a){var c=b.parent,d=b.article;a?(c.title=e.ARTICLE.preview+l(d.title),c.content=d.content):f.success(function(a){c.title=e.ARTICLE.markdown;c.content=a})}var g=c.ID&&"A"+c.ID,l=a.toStr,e=a.locale,m=a.rootScope.global;c=a.filter;var q=c("length");c("cutText");var n=a.restAPI.article,u=a.cache.article,s={title:"",content:"",refer:"",tagsList:[]},r=a.union(s);m.isLogin||a.location.search({}).path("/");m.title2=a.locale.ARTICLE.title;b.parent={edit:!!g,wmdPreview:!0,contentBytes:0,titleBytes:0,
title:"",content:""};b.validateTooltip=a.union(a.rootScope.validateTooltip);b.validateTooltip.placement="bottom";b.checkTitleMin=function(c,d){var f=q(d.$value);b.parent.titleBytes=f;b.parent.wmdPreview&&(b.parent.title=e.ARTICLE.preview+a.sanitize(a.trim(d.$value),0));return f>=m.TitleMinLen};b.checkTitleMax=function(a,b){return q(b.$value)<=m.TitleMaxLen};b.checkContentMin=function(a,c){var e=q(c.$value);b.parent.contentBytes=e;b.parent.wmdPreview&&(b.parent.content=c.$value);return e>=m.ContentMinLen};
b.checkContentMax=function(a,b){return q(b.$value)<=m.ContentMaxLen};b.checkTag=function(a,b){var c=b.$value||"",c=angular.isString(c)?c.split(/[,\uff0c\u3001]/):c;return c.length<=m.ArticleTagsMax};b.getTag=function(a){var c=b.article.tagsList;0>c.indexOf(a.tag)&&c.length<m.ArticleTagsMax&&(b.article.tagsList=c.concat(a.tag))};b.wmdPreview=function(){var a=b.parent;a.wmdPreview=!a.wmdPreview;k(a.wmdPreview)};b.submit=function(){var c=a.union(b.article);a.validate(b)&&(a.checkDirty(s,r,c)?(c.title=
a.sanitize(a.trim(c.title),0),n.save({ID:g||"index",OP:g&&"edit"},c,function(b){var c=b.data;u.put(c._id,b);h(c);a.toast.success(e.ARTICLE[g?"updated":"added"]+c.title);a.timing(null,1E3,2).then(function(){a.location.search({}).path("/"+c._id)})})):a.toast.info(e.ARTICLE.noUpdate))};b.$watchCollection("article",function(b){a.checkDirty(s,r,b)});d().run();g?a.promiseGet({ID:g},n,g,u).then(function(a){h(a.data)}):h()}]).controller("adminCtrl",["app","$scope","$routeParams",function(a,b,c){var d=a.rootScope.global;
c=c.OP||"index";if(!d.isEditor)return a.location.search({}).path("/");b.parent={getTpl:a.getFile.html(function(a){return"admin-"+("comment"===a?"article":a)+".html"}(c)),viewPath:c};d.title2=a.locale.ADMIN[c]}]).controller("adminUserCtrl",["app","$scope","$routeParams",function(a,b,c){function d(c){f=a.intersect(a.union(l),c);b.userList=a.union(f);b.parent.editSave=!!a.checkDirty(l,f,b.userList)}var f={},h=a.restAPI.user,k=a.myConf,g=a.locale;c={ID:"admin",p:c.p,s:c.s||k.pageSize(null,"userAdmin",
20)};var l=[{_id:"",name:"",locked:!1,email:"",role:0,score:0,date:0,lastLoginDate:0}];b.parent={editSave:!1,isSelectAll:!1};b.pagination={};b.roleArray=[0,1,2,3,4,5];b.selectAll=function(){a.each(b.userList,function(a){a.isSelect=b.parent.isSelectAll})};b.reset=function(){b.userList=a.union(f)};b.submit=function(){var c=[{_id:"",locked:!1,role:0}];if(a.validate(b)){var m=a.checkDirty(l,f,b.userList);a.isEmpty(m)?a.toast.info(g.USER.noUpdate):(m=a.intersect(c,m),h.save({ID:"admin"},{data:m},function(c){var e=
[];a.each(c.data,function(c){a.some(b.userList,function(b){if(c._id===b._id)return a.union(b,c),e.push(c.name),!0})});d(b.userList);a.toast.success(g.USER.updated+e.join(", "),g.RESPONSE.success)}))}};b.$watch("userList",function(c){b.parent.editSave=!!a.checkDirty(l,f,c)},!0);a.promiseGet(c,h).then(function(c){var f=c.pagination||{};f.path=a.location.path();f.pageSize=k.pageSize(f.pageSize,"userAdmin");f.sizePerPage=[20,100,200];b.pagination=f;d(c.data)})}]).controller("adminTagCtrl",["app","$scope",
"$routeParams",function(a,b,c){function d(c){f=a.union(a.union(l),c);b.tagList=a.union(f);b.parent.editSave=!!a.checkDirty(l,f,b.tagList)}var f={},h=a.restAPI.tag,k=a.myConf,g=a.locale;c={ID:"index",p:c.p,s:c.s||k.pageSize(null,"tagAdmin",20)};var l=[{_id:"",articles:0,tag:"",users:0}];b.parent={editSave:!1};b.pagination={};b.removeTag=null;b.removeTagModal={confirmBtn:g.BTN_TEXT.confirm,confirmFn:function(){var c=b.removeTag;h.remove({ID:c._id},function(){a.some(b.tagList,function(b,d,f){if(b._id===
c._id)return f.splice(d,1),a.toast.success(g.TAG.removed+c.tag,g.RESPONSE.success),!0});d(b.tagList);b.removeTag=null});return!0},cancelBtn:g.BTN_TEXT.cancel,cancelFn:function(){b.removeTag=null;return!0}};b.checkTag=function(b,c){var d=a.toStr(c.$value);return!/[,\uff0c\u3001]/.test(d)};b.checkTagMin=function(b,c){return 3<=a.filter("length")(c.$value)};b.reset=function(){b.tagList=a.union(f)};b.remove=function(a){b.removeTag=a;b.removeTagModal.modal(!0)};b.submit=function(){var c=[{_id:"",tag:""}];
if(a.validate(b)){var k=a.checkDirty(l,f,b.tagList);a.isEmpty(k)?a.toast.info(g.TAG.noUpdate):(k=a.intersect(c,k),h.save({ID:"admin"},{data:k},function(c){var e=[];a.each(k,function(d){var f=c.data[d._id];a.some(b.tagList,function(b,c,g){if(d._id===b._id)return f?(a.union(b,f),e.push(f.tag)):g.splice(c,1),!0})});d(b.tagList);a.toast.success(g.TAG.updated+e.join(", "),g.RESPONSE.success)}))}};b.$watch("tagList",function(c){b.parent.editSave=!!a.checkDirty(l,f,c)},!0);a.promiseGet(c,h).then(function(b){var c=
b.pagination||{};c.path=a.location.path();c.pageSize=k.pageSize(c.pageSize,"tagAdmin");c.sizePerPage=[20,50,100];d(b.data)})}]).controller("adminArticleCtrl",["app","$scope",function(a,b){}]).controller("adminGlobalCtrl",["app","$scope",function(a,b){function c(c){b.global=a.union(c);d=a.union(c);d=a.intersect(a.union(g),d);b.editGlobal=a.union(d);a.checkDirty(g,d,b.editGlobal)}var d={},f=a.locale,h=a.filter,k=a.restAPI.index;h("length");var g={domain:"",title:"",url:"",logo:"",email:"",description:"",
metatitle:"",metadesc:"",keywords:"",robots:"",TimeInterval:0,ArticleTagsMax:0,UserTagsMax:0,TitleMinLen:0,TitleMaxLen:0,SummaryMaxLen:0,ContentMinLen:0,ContentMaxLen:0,UserNameMinLen:0,UserNameMaxLen:0,register:!0,emailVerification:!0,UsersScore:[null,null,null,null,null,null],ArticleStatus:[null,null],ArticleHots:[null,null,null,null,null],userCache:0,articleCache:0,commentCache:0,listCache:0,tagCache:0,collectionCache:0,messageCache:0,paginationCache:[null,null],smtp:{host:"",secureConnection:!0,
port:0,auth:{user:"",pass:""},senderName:"",senderEmail:""}};b.parent={switchTab:"tab1"};b.reset=function(){b.editGlobal=a.union(d)};b.submit=function(){var h=a.union(b.editGlobal);a.validate(b)&&(h=a.checkDirty(g,d,h),a.isEmpty(h)?a.toast.info(f.ADMIN.noUpdate):k.save({OP:"admin"},h,function(b){c(b.data);b=a.union(d);delete b.smtp;delete b.email;a.union(a.rootScope.global,b);a.toast.success(f.ADMIN.updated,f.RESPONSE.success)}))};b.$watchCollection("editGlobal",function(b){a.checkDirty(g,d,b)});
a.promiseGet({OP:"admin"},k).then(function(a){c(a.data)})}]);

//app.js
angular.module("jsGen","jsGen.tools jsGen.router jsGen.filters jsGen.services jsGen.locale jsGen.directives jsGen.controllers".split(" ")).config(["$httpProvider","app",function(a,f){var b=0,g=!1,e={count:0,total:0,cancel:function(){b=0;g=!1;this.total=this.count=0;f.loading(!1,this)}};a.defaults.transformRequest.push(function(a){b+=1;e.count=b;e.total+=1;g||window.setTimeout(function(){!g&&0<b&&(g=!0,f.loading(!0,e))},1E3);return a});a.defaults.transformResponse.push(function(a){b-=1;e.count=b;g&&
0===b&&e.cancel();return a});a.interceptors.push(function(){return{response:function(a){var b,e=a.data;angular.isObject(e)&&(f.timestamp=e.timestamp,b=!e.ack&&e.error);return b?(f.toast.error(b.message,b.name),f.q.reject(e)):a},responseError:function(a){var b=a.data||a;a=a.status||"";var e=b.message||(angular.isObject(b)?"Error!":b);f.toast.error(e,a);return f.q.reject(b)}}})}]).run(["app","$q","$rootScope","$location","$timeout","$filter","$locale","getFile","tools","toast","timing","cache","restAPI",
"sanitize","mdParse","mdEditor","CryptoJS","promiseGet","myConf","anchorScroll","applyFn","param",function(a,f,b,g,e,t,h,u,v,w,p,x,l,y,z,A,B,C,D,E,q,F){function r(){var a=c.viewWidth=n.width();c.viewHeight=n.height();c.isPocket=480>a;c.isPhone=768>a;c.isTablet=!c.isPhone&&980>a;c.isDesktop=980<=a}function s(){l.index.get({},function(d){a.timeOffset=Date.now()-d.timestamp;d=d.data;d.title2=d.description;d.info.angularjs=angular.version.full;a.union(c,d);a.checkUser()})}var k=!1,m="",c=b.global={isAdmin:!1,
isEditor:!1,isLogin:!1},n=$(window);a.q=f;a.toast=w;a.param=F;a.timing=p;a.location=g;a.timeout=e;a.timeOffset=0;a.timestamp=Date.now()+0;a.filter=t;a.locale=h;a.anchorScroll=E;a.getFile=u;a.cache=x;a.restAPI=l;a.sanitize=y;a.mdParse=z;a.mdEditor=A;a.CryptoJS=B;a.promiseGet=C;a.myConf=D;a.rootScope=b;angular.extend(a,v);a.loading=function(a,c){b.loading.show=a;q()};a.validate=function(d,b){var c=[],e=[];d.$broadcast("genTooltipValidate",c,b);a.each(c,function(a){a.validate&&a.$invalid&&e.push(a)});
0===e.length?(a.validate.errorList=null,d.$broadcast("genTooltipValidate",c,!0)):a.validate.errorList=e;return!a.validate.errorList};a.checkDirty=function(d,b,c){(d=a.union(d))&&b&&c?(a.intersect(d,c),a.each(d,function(a,d,c){angular.equals(a,b[d])&&delete c[d]}),d=a.digestArray(d),k=!a.isEmpty(d)):k=!1;return k?d:null};a.removeItem=function(d,b,c){return a.some(c,function(a,e){if(a[b]===d[b])return c.splice(e,1),!0})};a.checkUser=function(){c.isLogin=!!c.user;c.isAdmin=c.user&&5===c.user.role;c.isEditor=
c.user&&4<=c.user.role};a.clearUser=function(){c.user=null;a.checkUser()};a.checkFollow=function(d){var b=c.user||{};d.isMe=d._id===b._id;d.isFollow=!d.isMe&&a.some(b.followList,function(a){return a===d._id})};b.loading={show:!1};b.validateTooltip={validate:!0,validateMsg:h.VALIDATE};b.unSaveModal={confirmBtn:h.BTN_TEXT.confirm,confirmFn:function(){k&&m&&(k=!1,e(function(){window.location.href=m},100));return!0},cancelBtn:h.BTN_TEXT.cancel,cancelFn:!0};b.$on("$locationChangeStart",function(a,c,e){k?
(a.preventDefault(),m=c,b.unSaveModal.modal(!0)):m=""});b.goBack=function(){window.history.go(-1)};b.logout=function(){l.user.get({ID:"logout"},function(){c.user=null;a.checkUser();g.path("/")})};b.followMe=function(b){l.user.save({ID:b._id},{follow:!b.isFollow},function(e){e.follow?(c.user.followList.push(b._id),a.toast.success(h.USER.followed+b.name,h.RESPONSE.success)):a.some(c.user.followList,function(c,e,f){if(c===b._id)return f.splice(e,1),a.toast.success(h.USER.unfollowed+b.name,h.RESPONSE.success),
!0});b.fans+=b.isFollow?-1:1;b.isFollow=!b.isFollow})};n.resize(q.bind(null,r));p(function(){24E4<=Date.now()-a.timestamp-a.timeOffset&&s()},6E4);r();s()}]);
