/**
Author: Gabriel Birke (mailto:gabriel@lebenplusplus.de)
Version: 1.0
Copyright: Copyright (c) 2010 Gabriel Birke. All rights reserved.
License: MIT License (http://opensource.org/licenses/mit-license.php)
Website: http://github.com/gbirke/Sanitize.js
**/
(function(){function c(d){var a;a=d||{};this.config={};this.config.elements=a.elements?a.elements:[];this.config.attributes=a.attributes?a.attributes:{};this.config.attributes[c.ALL]=this.config.attributes[c.ALL]?this.config.attributes[c.ALL]:[];this.config.allow_comments=a.allow_comments?a.allow_comments:!1;this.allowed_elements={};this.config.protocols=a.protocols?a.protocols:{};this.config.add_attributes=a.add_attributes?a.add_attributes:{};this.dom=a.dom?a.dom:document;for(d=0;d<this.config.elements.length;d++)this.allowed_elements[this.config.elements[d]]=
!0;this.config.remove_element_contents={};this.config.remove_all_contents=!1;if(a.remove_contents)if(a.remove_contents instanceof Array)for(d=0;d<a.remove_contents.length;d++)this.config.remove_element_contents[a.remove_contents[d]]=!0;else this.config.remove_all_contents=!0;this.transformers=a.transformers?a.transformers:[]}c.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i;c.RELATIVE="__relative__";c.prototype.clean_node=function(d){function a(a,c){var b;for(b=0;b<c.length;b++)if(c[b]==
a)return b;return-1}function m(){var a=[],c={},b,g;for(b=0;b<arguments.length;b++)if(arguments[b]&&arguments[b].length)for(g=0;g<arguments[b].length;g++)c[arguments[b][g]]||(c[arguments[b][g]]=!0,a.push(arguments[b][g]));return a}function n(e){var h;switch(e.nodeType){case 1:var b,g,j,k,f,d,l;b=[];g=e;k=!1;for(j=0;j<this.transformers.length;j++)if(f=this.transformers[j]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,
dom:this.dom}),null!=f)if("object"==typeof f){if(f.whitelist_nodes&&f.whitelist_nodes instanceof Array)for(k=0;k<f.whitelist_nodes.length;k++)-1==a(f.whitelist_nodes[k],this.whitelist_nodes)&&this.whitelist_nodes.push(f.whitelist_nodes[k]);k=f.whitelist?!0:!1;f.attr_whitelist&&(b=m(b,f.attr_whitelist));g=f.node?f.node:g}else throw Error("transformer output must be an object or null");e=g;j=e.nodeName.toLowerCase();g=this.current_element;if(this.allowed_elements[j]||k){this.current_element=this.dom.createElement(e.nodeName);
g.appendChild(this.current_element);k=this.config.attributes;k=m(k[j],k.__ALL__,b);for(b=0;b<k.length;b++)if(h=k[b],f=e.attributes[h])d=!0,this.config.protocols[j]&&this.config.protocols[j][h]&&(d=this.config.protocols[j][h],d=(l=f.nodeValue.toLowerCase().match(c.REGEX_PROTOCOL))?-1!=a(l[1],d):-1!=a(c.RELATIVE,d)),d&&(d=document.createAttribute(h),d.value=f.nodeValue,this.current_element.setAttributeNode(d));if(this.config.add_attributes[j])for(h in this.config.add_attributes[j])d=document.createAttribute(h),
d.value=this.config.add_attributes[j][h],this.current_element.setAttributeNode(d)}else if(-1!=a(e,this.whitelist_nodes)){for(this.current_element=e.cloneNode(!0);0<this.current_element.childNodes.length;)this.current_element.removeChild(this.current_element.firstChild);g.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[j])for(b=0;b<e.childNodes.length;b++)n.call(this,e.childNodes[b]);this.current_element.normalize&&this.current_element.normalize();
this.current_element=g;break;case 3:h=e.cloneNode(!1);this.current_element.appendChild(h);break;case 5:h=e.cloneNode(!1);this.current_element.appendChild(h);break;case 8:this.config.allow_comments&&(h=e.cloneNode(!1),this.current_element.appendChild(h));break;default:console&&console.log&&console.log("unknown node type",e.nodeType)}}var l=this.dom.createDocumentFragment();this.current_element=l;this.whitelist_nodes=[];for(i=0;i<d.childNodes.length;i++)n.call(this,d.childNodes[i]);l.normalize&&l.normalize();
return l};c.Config={};c.Config.BASIC={elements:"a b blockquote br cite code dd dl dt em i li ol p pre q small strike strong sub sup u ul".split(" "),attributes:{a:["href"],blockquote:["cite"],q:["cite"]},add_attributes:{a:{rel:"nofollow"}},protocols:{a:{href:["ftp","http","https","mailto",c.RELATIVE]},blockquote:{cite:["http","https",c.RELATIVE]},q:{cite:["http","https",c.RELATIVE]}}};c.Config.RELAXED={elements:"a b blockquote br caption cite code col colgroup dd dl dt em h1 h2 h3 h4 h5 h6 i img li ol p pre q small strike strong sub sup table tbody td tfoot th thead tr u ul".split(" "),
attributes:{a:["href","title"],blockquote:["cite"],col:["span","width"],colgroup:["span","width"],img:"align alt height src title width".split(" "),ol:["start","type"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:"abbr axis colspan rowspan scope width".split(" "),ul:["type"]},protocols:{a:{href:["ftp","http","https","mailto",c.RELATIVE]},blockquote:{cite:["http","https",c.RELATIVE]},img:{src:["http","https",c.RELATIVE]},q:{cite:["http","https",c.RELATIVE]}}};
c.Config.RESTRICTED={elements:["b","em","i","strong","u"]};"object"===typeof exports&&"function"===typeof require?exports=c:this.Sanitize=c}).call(function(){return this||("undefined"!==typeof window?window:global)}());
